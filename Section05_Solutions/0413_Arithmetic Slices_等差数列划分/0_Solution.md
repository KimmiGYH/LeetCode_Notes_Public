# 413_Arithmetic Slices_等差数列划分

## 解法一：差分

- 寻找差分数组里连续相等的一段
- 至少包含三个元素
- 相邻两个元素的差相等

例子：
$1 \ 2 \ 3 \ 4$ 总共有 $3$ 等差数列：$[1, 2, 3]$, $[2, 3, 4]$ and $[1, 2, 3, 4]$

- 原数组：$a_{1}, a_{2}, a_{3}, ..., a_{n}$
- 差分数组 $b$：$a_{1}, \ a_{2} - a_{1}, \ a_{3} - a_{2}, \ ..., a_{n} - a_{n-1}$

- 什么是差分数组？

    一个数组为 $[a_{1}, a_{2}, a_{3}, a_{4}]$，其差分数组为 $[b_{1}, b_{2}, b_{3}, b_{4}]$，即 $[a_{1}, a_{2} - a_{1}, a_{3} - a_{2}, a_{4} - a_{3}]$

- 构建差分数组，在 $A[]$ 上存差分数组
  
  ```cpp
    for (int i = A.size() - 1; i > 0; i--)  A[i] -= A[i - 1];
  ```

- 原数组从 `L ~ R` 是等差数列，意味着从 `L+1 ~ R` 是差分数组，
- 等价于在差分数组里寻找相等的一段
- 如果一段差分数组中有 $k$ 个数，相当于问这段中有多少个长度 $\ge 3$ 的子区间？
- 一段差分数组有 $k$ 个数，等价于原数组有 $k+1$ 个数，要求子区间至少有 $3$ 个元素，那么
- |--------------------------| 原数组$k+1$个数
-   |------------------------| 差分数组$k$个数
-     |----------------------| 从$k-1$个数中选
- 每往右推，就剩 $k-2$、$k-3$…… 直到 $1$
- 如果连续相等的区间长度是 $k$ 的话，求子区间个数 $k-1$ + $k-2$ + ... + $1$，高斯定理累加即可。


- 解法：这题本质上就是求出差分数组中连续相等区间，再找出每个区间内长度大于 $3$ 的子区间个数，最后求和
    - 假设一段区间内有 $k$ 个数，$1,2,3,...k$(下标)
    - 左端点取 $1$ 时，右端点可取 $2,3,...k$，共 $k-1$ 个
    - 左端点取 $2$ 时，右端点可取 $3,4,...k$，共 $k-2$ 个
    - ...
    - 左端点取 $k-1$ 时，右端点可取 $k$，共 $1$ 个
    - 所以子区间个数为 $k(k-1)/2$
