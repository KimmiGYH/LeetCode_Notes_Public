# 786_K-th Smallest Prime Fraction_第 K 个最小的素数分数

## 解法一：自定义排序 $O(n^2 \log n)$

- 记数组 $arr$ 的长度为 $n$。我们可以将全部的 $\dfrac{n(n-1)}{2}$ 个分数放入数组中进行自定义排序，规则为将这些分数按照升序进行排序。
- 在排序完成后，我们就可以得到第 $k$ 个最小的素数分数。

细节：
- 当我们比较两个分数 $\dfrac{a}{b}$ 和 $\dfrac{c}{d}$ 时，我们可以直接对它们的值进行比较，但这会产生浮点数的计算，降低程序的效率，并且可能会引入浮点数误差。
- 一种可行的替代方法是用：$a×d<b×c$ 来替代 $\dfrac{a}{b} < \dfrac{c}{d}$ 的判断，二者是等价的。

**复杂度分析**

- 时间复杂度：$O(n^2 \log n)$，其中 $n$ 是数组 $arr$ 的长度。素数分数一共有 $\dfrac{n(n-1)}{2} = O(n^2)$ 个，因此排序需要的时间为 $O(n^2 \log n)$。
- 空间复杂度：$O(n^2)$，即为存储所有素数分数需要的空间。

## 解法二：优先队列

- 当分母为给定的 $arr[j]$ 时，分子可以在 $arr[0], ..., arr[j - 1]$ 中进行选择。由于数组 $arr$ 时严格递增的，那么记分子 $arr[i] (0 \le i < j)$，随着 $i$ 的增加，分数的值也是严格递增的。

- 因此，我们可以将每个分母 $arr[j]$ 看成一个长度为 $j$ 的列表，它包含了：
$\frac{arr[0]}{arr[j]}, \frac{arr[1]}{arr[j]}, \dots, \frac{arr[j-1]}{arr[j]}$
这些分数，并且它们的值时严格递增的。我们的目标是找出这 $n-1$ 个列表（$arr[0]$ 的列表为空，我们可以直接忽略，因为分母 $arr[j]$ 不能取到 $arr[0]$）中第 $k$ 小的素数分数。

- 初始时，优先队列中存储了 $n-1$ 个分数 $\frac{arr[0]}{arr[1]}, \dots, \frac{arr[0]}{arr[n-1]}$。在求解答案的过程中，我们每次从优先队列中取出一个最小的分数，记为 $\frac{arr[i]}{arr[j]}$。如果 $i + 1 < j$，我们将一个新的分数 $\frac{arr[i + 1]}{arr[j]}$ 放入优先队列中。
- 这样一来，当我们进行第 $k$ 次「取出」操作时，得到的分数就是第 $k$ 小的素数分数。

**复杂度分析**

- 时间复杂度：$O(k \log n)$，其中 $n$ 是数组 $arr$ 的长度。优先队列的单次操作时间复杂度为$O(\log n)$，一共需要进行 $O(k)$ 次操作。
- 空间复杂度：$O(n)$，即为优先队列需要使用的空间。


## 解法三：二分查找 + 双指针 $O(n \log C)$

- 二段性：满足 $\le x$ 的数的个数是否 $\ge k$ 个，求满足该条件的最小的数
  
  利用 $arr$ 递增，且每个点对 $(i, j)$ 满足 $i < j$，我们可以确定 $(i, j)$ 对应的分数 $\frac{arr[i]}{arr[j]}$ 必然落在 $[0, 1]$ 范围内。

  假设最终答案 $\frac{arr[i]}{arr[j]}$ 为 $x$，那么以 $x$ 为分割点的数轴（该数轴上的点为 $arr$ 所能构造的分数值）上具有「二段性」：

  - 小于等于 $x$ 的值满足：其左边分数值个数小于 $k$ 个；
  - 大于 $x$ 的值不满足：其左边分数值个数小于 $k$ 个（即至少有 $k$ 个）。

- 对于 $x$，我们如何求出有多少个小于 $x$ 的素数分数呢？我们可以使用双指针来求出答案：
  - 我们使用一个指针 $j$ 指向分母，这个指针每次会向右移动一个位置，表示枚举不同的分母；
  - 我们再使用一个指针 $i$ 指向分子，这个指针会不断向右移动，并且保证 $\dfrac{\textit{arr}[i]}{\textit{arr}[j]} < x$ 一直成立。当指针 $i$ 无法移动时，我们就可以知道 $arr[0],⋯,arr[i]$ 都可以作为分子，但 $arr[i+1]$ 及以后的元素都不可以，即分母为 $arr[j]$ 并且小于 $x$ 的素数分数有 $i+1$ 个。
  - 在 $j$ 向右移动的过程中，我们把每一个 $j$ 对应的 $i+1$ 都加入答案。这样在双指针的过程完成后，我们就可以得到有多少个小于 $x$ 的素数分数了。

- 如果我们得到的答案恰好等于 $k$，那么我们再进行一遍上面的过程，求出所有 $\dfrac{\textit{arr}[i]}{\textit{arr}[j]}$ 中的最大值即为第 $k$ 个最小的素数分数。
- 如果答案大于 $k$，这说明我们猜测的 $x$ 太大了，答案在左半边，我们需要减少它的值：$r = mid$
- 如果答案小于 $k$，这说明我们猜测的 $x$ 太小了，答案在右半边，我们需要增加它的值：$l = mid$

**细节**
由于我们是在实数范围内进行二分查找，那么最坏情况下需要进行多少步查找呢？
- 可以发现，数组 $arr$ 中元素的最大值为 $3 \times 10^{4}$，即任意两个素数分数的差值不会小于 $\frac{1}{(3 \times 10^{4})^{2}} = \frac{1}{9 \times 10^{8}}$。
- 二分查找的初始区间为 $[0, 1]$，每一步区间的长度会减少一半，因此在进行第 $\left \lceil \log_{}{(9 \times 10^{8})}  \right \rceil = 30$ 次二分查找后，区间的长度小于 $\frac{1}{9 \times 10^{8}}$，这时就可以结束二分查找并返回答案。

**复杂度分析**

- 时间复杂度：$O(n \log C)$，其中 $n$ 是数组 $arr$ 的长度，$C$ 是数组 $arr$ 中元素的上界。二分查找需要进行 $\lceil \log C^{2} \rceil = O(\log C)$ 次，每一步需要 $O(n)$ 的时间得到小于 $x$ 的素数分数的个数。
- 空间复杂度：$O(1)$。
